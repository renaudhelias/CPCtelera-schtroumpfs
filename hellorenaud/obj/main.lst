                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 3.6.8 #9946 (Linux)
                              4 ;--------------------------------------------------------
                              5 	.module main
                              6 	.optsdcc -mz80
                              7 	
                              8 ;--------------------------------------------------------
                              9 ; Public variables in this module
                             10 ;--------------------------------------------------------
                             11 	.globl _main
                             12 	.globl _myInterruptHandler
                             13 	.globl _crtc
                             14 	.globl _wait_frame_flyback
                             15 	.globl _calque4000
                             16 	.globl _calqueC000
                             17 	.globl _rupture
                             18 	.globl _restoreVBL
                             19 	.globl _killVBL
                             20 	.globl _cpct_getScreenPtr
                             21 	.globl _cpct_setVideoMemoryOffset
                             22 	.globl _cpct_setPALColour
                             23 	.globl _cpct_setPalette
                             24 	.globl _cpct_setVideoMode
                             25 	.globl _cpct_hflipSpriteM0
                             26 	.globl _cpct_drawSolidBox
                             27 	.globl _cpct_drawSpriteMasked
                             28 	.globl _cpct_drawSprite
                             29 	.globl _cpct_px2byteM0
                             30 	.globl _cpct_memset_f64
                             31 	.globl _cpct_setInterruptHandler
                             32 	.globl _slow
                             33 	.globl _hOffset
                             34 	.globl _intCounter
                             35 	.globl _screen_plot_address
                             36 	.globl _screen_location
                             37 	.globl _g_items_0
                             38 ;--------------------------------------------------------
                             39 ; special function registers
                             40 ;--------------------------------------------------------
                             41 ;--------------------------------------------------------
                             42 ; ram data
                             43 ;--------------------------------------------------------
                             44 	.area _DATA
   0000                      45 _screen_location::
   0000                      46 	.ds 2
   0002                      47 _screen_plot_address::
   0002                      48 	.ds 2
                             49 ;--------------------------------------------------------
                             50 ; ram data
                             51 ;--------------------------------------------------------
                             52 	.area _INITIALIZED
   0000                      53 _intCounter::
   0000                      54 	.ds 1
   0001                      55 _hOffset::
   0001                      56 	.ds 2
   0003                      57 _slow::
   0003                      58 	.ds 1
                             59 ;--------------------------------------------------------
                             60 ; absolute external ram data
                             61 ;--------------------------------------------------------
                             62 	.area _DABS (ABS)
                             63 ;--------------------------------------------------------
                             64 ; global & static initialisations
                             65 ;--------------------------------------------------------
                             66 	.area _HOME
                             67 	.area _GSINIT
                             68 	.area _GSFINAL
                             69 	.area _GSINIT
                             70 ;--------------------------------------------------------
                             71 ; Home
                             72 ;--------------------------------------------------------
                             73 	.area _HOME
                             74 	.area _HOME
                             75 ;--------------------------------------------------------
                             76 ; code
                             77 ;--------------------------------------------------------
                             78 	.area _CODE
                             79 ;src/main.c:67: void wait_frame_flyback() {
                             80 ;	---------------------------------
                             81 ; Function wait_frame_flyback
                             82 ; ---------------------------------
   0000                      83 _wait_frame_flyback::
                             84 ;src/main.c:73: __endasm;
   0000 06 F5         [ 7]   85 	ld	b,#0xf5 ;wait frame flyback
   0002                      86 	l1:
   0002 ED 78         [12]   87 	in a,(c)
   0004 1F            [ 4]   88 	rra
   0005 30 FB         [12]   89 	jr	nc,l1
   0007 C9            [10]   90 	ret
   0008                      91 _g_items_0:
   0008 05                   92 	.db #0x05	; 5
   0009 0F                   93 	.db #0x0f	; 15
   000A 0F                   94 	.db #0x0f	; 15
   000B 00                   95 	.db #0x00	; 0
   000C 0F                   96 	.db #0x0f	; 15
   000D 0F                   97 	.db #0x0f	; 15
   000E 0F                   98 	.db #0x0f	; 15
   000F 0A                   99 	.db #0x0a	; 10
   0010 0F                  100 	.db #0x0f	; 15
   0011 0A                  101 	.db #0x0a	; 10
   0012 05                  102 	.db #0x05	; 5
   0013 00                  103 	.db #0x00	; 0
   0014 0F                  104 	.db #0x0f	; 15
   0015 0A                  105 	.db #0x0a	; 10
   0016 05                  106 	.db #0x05	; 5
   0017 00                  107 	.db #0x00	; 0
   0018 05                  108 	.db #0x05	; 5
   0019 0F                  109 	.db #0x0f	; 15
   001A 0A                  110 	.db #0x0a	; 10
   001B 0A                  111 	.db #0x0a	; 10
   001C 00                  112 	.db #0x00	; 0
   001D 0F                  113 	.db #0x0f	; 15
   001E 0F                  114 	.db #0x0f	; 15
   001F 0A                  115 	.db #0x0a	; 10
   0020 00                  116 	.db #0x00	; 0
   0021 0A                  117 	.db #0x0a	; 10
   0022 0A                  118 	.db #0x0a	; 10
   0023 0A                  119 	.db #0x0a	; 10
   0024 00                  120 	.db #0x00	; 0
   0025 00                  121 	.db #0x00	; 0
   0026 00                  122 	.db #0x00	; 0
   0027 00                  123 	.db #0x00	; 0
                            124 ;src/main.c:76: void crtc(u8* R12R13) {
                            125 ;	---------------------------------
                            126 ; Function crtc
                            127 ; ---------------------------------
   0028                     128 _crtc::
                            129 ;src/main.c:93: __endasm;
   0028 DD E5         [15]  130 	push	ix
   002A DD 21 00 00   [14]  131 	ld	ix,#0
   002E DD 39         [15]  132 	add	ix,sp
   0030 DD 66 05      [19]  133 	ld	h, 5 (ix)
   0033 DD 6E 04      [19]  134 	ld	l, 4 (ix)
   0036 01 0C BC      [10]  135 	ld	bc,#0xbc00+12
   0039 ED 49         [12]  136 	out	(c),c
   003B 04            [ 4]  137 	inc	b
   003C ED 61         [12]  138 	out	(c),h
   003E 05            [ 4]  139 	dec	b
   003F 0C            [ 4]  140 	inc	c
   0040 ED 49         [12]  141 	out	(c),c
   0042 04            [ 4]  142 	inc	b
   0043 ED 69         [12]  143 	out	(c),l
   0045 DD E1         [14]  144 	pop	ix
   0047 C9            [10]  145 	ret
                            146 ;src/main.c:106: void myInterruptHandler() {
                            147 ;	---------------------------------
                            148 ; Function myInterruptHandler
                            149 ; ---------------------------------
   0048                     150 _myInterruptHandler::
                            151 ;src/main.c:109: intCounter=intCounter+1;
   0048 FD 21r00r00   [14]  152 	ld	iy, #_intCounter
   004C FD 34 00      [23]  153 	inc	0 (iy)
                            154 ;src/main.c:110: if (intCounter == 6) intCounter=0;
   004F FD 7E 00      [19]  155 	ld	a, 0 (iy)
   0052 D6 06         [ 7]  156 	sub	a, #0x06
   0054 20 04         [12]  157 	jr	NZ,00102$
   0056 FD 36 00 00   [19]  158 	ld	0 (iy), #0x00
   005A                     159 00102$:
                            160 ;src/main.c:112: if (intCounter == 2) {
   005A 3Ar00r00      [13]  161 	ld	a,(#_intCounter + 0)
   005D D6 02         [ 7]  162 	sub	a, #0x02
   005F 20 09         [12]  163 	jr	NZ,00104$
                            164 ;src/main.c:113: cpct_setBorder(2);
   0061 21 10 02      [10]  165 	ld	hl, #0x0210
   0064 E5            [11]  166 	push	hl
   0065 CDr00r00      [17]  167 	call	_cpct_setPALColour
   0068 18 07         [12]  168 	jr	00105$
   006A                     169 00104$:
                            170 ;src/main.c:115: cpct_setBorder(3);
   006A 21 10 03      [10]  171 	ld	hl, #0x0310
   006D E5            [11]  172 	push	hl
   006E CDr00r00      [17]  173 	call	_cpct_setPALColour
   0071                     174 00105$:
                            175 ;src/main.c:124: if (intCounter==5) {
   0071 FD 21r00r00   [14]  176 	ld	iy, #_intCounter
   0075 FD 7E 00      [19]  177 	ld	a, 0 (iy)
   0078 D6 05         [ 7]  178 	sub	a, #0x05
   007A 20 5B         [12]  179 	jr	NZ,00107$
                            180 ;src/main.c:154: __endasm;
   007C 01 06 BC      [10]  181 	ld	bc,#0xbc06
   007F ED 49         [12]  182 	out	(c),c
   0081 01 04 BD      [10]  183 	ld	bc,#0xbd04
   0084 ED 49         [12]  184 	out	(c),c
                            185 ;src/main.c:156: screen_location++;
   0086 FD 21r00r00   [14]  186 	ld	iy, #_screen_location
   008A FD 34 00      [23]  187 	inc	0 (iy)
   008D 20 03         [12]  188 	jr	NZ,00140$
   008F FD 34 01      [23]  189 	inc	1 (iy)
   0092                     190 00140$:
                            191 ;src/main.c:157: screen_location=(u8 *)(((unsigned int)screen_location) & 0x13FF);
   0092 2Ar00r00      [16]  192 	ld	hl, (_screen_location)
   0095 7C            [ 4]  193 	ld	a, h
   0096 E6 13         [ 7]  194 	and	a, #0x13
   0098 67            [ 4]  195 	ld	h, a
   0099 22r00r00      [16]  196 	ld	(_screen_location), hl
                            197 ;src/main.c:158: crtc(screen_location);
   009C 2Ar00r00      [16]  198 	ld	hl, (_screen_location)
   009F E5            [11]  199 	push	hl
   00A0 CDr28r00      [17]  200 	call	_crtc
   00A3 F1            [10]  201 	pop	af
                            202 ;src/main.c:160: screen_plot_address++;
   00A4 FD 21r02r00   [14]  203 	ld	iy, #_screen_plot_address
   00A8 FD 34 00      [23]  204 	inc	0 (iy)
   00AB 20 03         [12]  205 	jr	NZ,00141$
   00AD FD 34 01      [23]  206 	inc	1 (iy)
   00B0                     207 00141$:
                            208 ;src/main.c:161: screen_plot_address=(u8 *)(((unsigned int)screen_plot_address) & 0x47FF);
   00B0 2Ar02r00      [16]  209 	ld	hl, (_screen_plot_address)
   00B3 7C            [ 4]  210 	ld	a, h
   00B4 E6 47         [ 7]  211 	and	a, #0x47
   00B6 67            [ 4]  212 	ld	h, a
   00B7 22r02r00      [16]  213 	ld	(_screen_plot_address), hl
                            214 ;src/main.c:162: screen_plot_address++;
   00BA FD 34 00      [23]  215 	inc	0 (iy)
   00BD 20 03         [12]  216 	jr	NZ,00142$
   00BF FD 34 01      [23]  217 	inc	1 (iy)
   00C2                     218 00142$:
                            219 ;src/main.c:163: screen_plot_address=(u8 *)(((unsigned int)screen_plot_address) & 0x47FF);
   00C2 2Ar02r00      [16]  220 	ld	hl, (_screen_plot_address)
   00C5 7C            [ 4]  221 	ld	a, h
   00C6 E6 47         [ 7]  222 	and	a, #0x47
   00C8 67            [ 4]  223 	ld	h, a
   00C9 22r02r00      [16]  224 	ld	(_screen_plot_address), hl
                            225 ;src/main.c:166: killVBL();
   00CC CDr00r00      [17]  226 	call	_killVBL
                            227 ;src/main.c:167: rupture(19-1);
   00CF 3E 12         [ 7]  228 	ld	a, #0x12
   00D1 F5            [11]  229 	push	af
   00D2 33            [ 6]  230 	inc	sp
   00D3 CDr00r00      [17]  231 	call	_rupture
   00D6 33            [ 6]  232 	inc	sp
   00D7                     233 00107$:
                            234 ;src/main.c:172: if (intCounter==2) {
   00D7 FD 21r00r00   [14]  235 	ld	iy, #_intCounter
   00DB FD 7E 00      [19]  236 	ld	a, 0 (iy)
   00DE D6 02         [ 7]  237 	sub	a, #0x02
   00E0 20 1A         [12]  238 	jr	NZ,00109$
                            239 ;src/main.c:178: __endasm;
   00E2 01 06 BC      [10]  240 	ld	bc,#0xbc06
   00E5 ED 49         [12]  241 	out	(c),c
   00E7 01 19 BD      [10]  242 	ld	bc,#0xbd19
   00EA ED 49         [12]  243 	out	(c),c
                            244 ;src/main.c:179: calqueC000();
   00EC CDr00r00      [17]  245 	call	_calqueC000
                            246 ;src/main.c:180: cpct_setVideoMemoryOffset(0);
   00EF 2E 00         [ 7]  247 	ld	l, #0x00
   00F1 CDr00r00      [17]  248 	call	_cpct_setVideoMemoryOffset
                            249 ;src/main.c:181: rupture(7);
   00F4 3E 07         [ 7]  250 	ld	a, #0x07
   00F6 F5            [11]  251 	push	af
   00F7 33            [ 6]  252 	inc	sp
   00F8 CDr00r00      [17]  253 	call	_rupture
   00FB 33            [ 6]  254 	inc	sp
   00FC                     255 00109$:
                            256 ;src/main.c:184: if (intCounter==3) {
   00FC 3Ar00r00      [13]  257 	ld	a,(#_intCounter + 0)
   00FF D6 03         [ 7]  258 	sub	a, #0x03
   0101 C0            [11]  259 	ret	NZ
                            260 ;src/main.c:185: calqueC000();
   0102 CDr00r00      [17]  261 	call	_calqueC000
                            262 ;src/main.c:186: cpct_setVideoMemoryOffset(0);
   0105 2E 00         [ 7]  263 	ld	l, #0x00
   0107 CDr00r00      [17]  264 	call	_cpct_setVideoMemoryOffset
                            265 ;src/main.c:187: restoreVBL();
   010A CDr00r00      [17]  266 	call	_restoreVBL
                            267 ;src/main.c:188: rupture(39-19-7+1);
   010D 3E 0E         [ 7]  268 	ld	a, #0x0e
   010F F5            [11]  269 	push	af
   0110 33            [ 6]  270 	inc	sp
   0111 CDr00r00      [17]  271 	call	_rupture
   0114 33            [ 6]  272 	inc	sp
   0115 C9            [10]  273 	ret
                            274 ;src/main.c:193: void main(void) {
                            275 ;	---------------------------------
                            276 ; Function main
                            277 ; ---------------------------------
   0116                     278 _main::
   0116 DD E5         [15]  279 	push	ix
   0118 DD 21 00 00   [14]  280 	ld	ix,#0
   011C DD 39         [15]  281 	add	ix,sp
   011E F5            [11]  282 	push	af
   011F F5            [11]  283 	push	af
                            284 ;src/main.c:195: int s=0;
   0120 DD 36 FE 00   [19]  285 	ld	-2 (ix), #0x00
   0124 DD 36 FF 00   [19]  286 	ld	-1 (ix), #0x00
                            287 ;src/main.c:197: u8* sprite=g_items_0;
                            288 ;src/main.c:213: cpct_setInterruptHandler(myInterruptHandler);
   0128 21r48r00      [10]  289 	ld	hl, #_myInterruptHandler
   012B CDr00r00      [17]  290 	call	_cpct_setInterruptHandler
                            291 ;src/main.c:223: cpct_setVideoMode(0);
   012E 2E 00         [ 7]  292 	ld	l, #0x00
   0130 CDr00r00      [17]  293 	call	_cpct_setVideoMode
                            294 ;src/main.c:225: cpct_setBorder(HW_BLACK);
   0133 21 10 14      [10]  295 	ld	hl, #0x1410
   0136 E5            [11]  296 	push	hl
   0137 CDr00r00      [17]  297 	call	_cpct_setPALColour
                            298 ;src/main.c:227: cpct_setPalette(g_tile_palette, 6);
   013A 21 06 00      [10]  299 	ld	hl, #0x0006
   013D E5            [11]  300 	push	hl
   013E 21r00r00      [10]  301 	ld	hl, #_g_tile_palette
   0141 E5            [11]  302 	push	hl
   0142 CDr00r00      [17]  303 	call	_cpct_setPalette
                            304 ;src/main.c:238: cpct_memset_f64(CPCT_VMEM_START, 0xFFFF, 0x2000);
   0145 21 00 20      [10]  305 	ld	hl, #0x2000
   0148 E5            [11]  306 	push	hl
   0149 21 FF FF      [10]  307 	ld	hl, #0xffff
   014C E5            [11]  308 	push	hl
   014D 21 00 C0      [10]  309 	ld	hl, #0xc000
   0150 E5            [11]  310 	push	hl
   0151 CDr00r00      [17]  311 	call	_cpct_memset_f64
                            312 ;src/main.c:241: cpct_hflipSpriteM0(4, 8, sprite);
   0154 01r08r00      [10]  313 	ld	bc, #_g_items_0
   0157 C5            [11]  314 	push	bc
   0158 C5            [11]  315 	push	bc
   0159 21 04 08      [10]  316 	ld	hl, #0x0804
   015C E5            [11]  317 	push	hl
   015D CDr00r00      [17]  318 	call	_cpct_hflipSpriteM0
   0160 C1            [10]  319 	pop	bc
                            320 ;src/main.c:242: cpct_drawSprite(sprite, p, 4, 8);
   0161 D1            [10]  321 	pop	de
   0162 D5            [11]  322 	push	de
   0163 21 04 08      [10]  323 	ld	hl, #0x0804
   0166 E5            [11]  324 	push	hl
   0167 D5            [11]  325 	push	de
   0168 C5            [11]  326 	push	bc
   0169 CDr00r00      [17]  327 	call	_cpct_drawSprite
                            328 ;src/main.c:244: p = cpct_getScreenPtr(CPCT_VMEM_START, 16-1,32-1);
   016C 21 0F 1F      [10]  329 	ld	hl, #0x1f0f
   016F E5            [11]  330 	push	hl
   0170 21 00 C0      [10]  331 	ld	hl, #0xc000
   0173 E5            [11]  332 	push	hl
   0174 CDr00r00      [17]  333 	call	_cpct_getScreenPtr
                            334 ;src/main.c:246: cpct_drawSolidBox(p, cpct_px2byteM0(2, 3), 10, 20);
   0177 E5            [11]  335 	push	hl
   0178 21 02 03      [10]  336 	ld	hl, #0x0302
   017B E5            [11]  337 	push	hl
   017C CDr00r00      [17]  338 	call	_cpct_px2byteM0
   017F 55            [ 4]  339 	ld	d, l
   0180 C1            [10]  340 	pop	bc
   0181 21 0A 14      [10]  341 	ld	hl, #0x140a
   0184 E5            [11]  342 	push	hl
   0185 D5            [11]  343 	push	de
   0186 33            [ 6]  344 	inc	sp
   0187 C5            [11]  345 	push	bc
   0188 CDr00r00      [17]  346 	call	_cpct_drawSolidBox
   018B F1            [10]  347 	pop	af
   018C F1            [10]  348 	pop	af
   018D 33            [ 6]  349 	inc	sp
                            350 ;src/main.c:249: p = cpct_getScreenPtr(CPCT_VMEM_START, 10-1,80-1);
   018E 21 09 4F      [10]  351 	ld	hl, #0x4f09
   0191 E5            [11]  352 	push	hl
   0192 21 00 C0      [10]  353 	ld	hl, #0xc000
   0195 E5            [11]  354 	push	hl
   0196 CDr00r00      [17]  355 	call	_cpct_getScreenPtr
   0199 33            [ 6]  356 	inc	sp
   019A 33            [ 6]  357 	inc	sp
                            358 ;src/main.c:250: cpct_drawSpriteMasked(g_tile_schtroumpf, p, G_TILE_SCHTROUMPF_W, G_TILE_SCHTROUMPF_H);
   019B 4D            [ 4]  359 	ld	c, l
   019C 44            [ 4]  360 	ld	b, h
   019D C5            [11]  361 	push	bc
   019E 21 10 20      [10]  362 	ld	hl, #0x2010
   01A1 E5            [11]  363 	push	hl
   01A2 C5            [11]  364 	push	bc
   01A3 21r00r00      [10]  365 	ld	hl, #_g_tile_schtroumpf
   01A6 E5            [11]  366 	push	hl
   01A7 CDr00r00      [17]  367 	call	_cpct_drawSpriteMasked
                            368 ;src/main.c:288: cpct_memset_f64(0x4000,0x00,0x4000); // SCR_VMEM, 0, 0x4000
   01AA 21 00 40      [10]  369 	ld	hl, #0x4000
   01AD E5            [11]  370 	push	hl
   01AE 26 00         [ 7]  371 	ld	h, #0x00
   01B0 E5            [11]  372 	push	hl
   01B1 26 40         [ 7]  373 	ld	h, #0x40
   01B3 E5            [11]  374 	push	hl
   01B4 CDr00r00      [17]  375 	call	_cpct_memset_f64
                            376 ;src/main.c:298: calque4000(); // faut que le AND du début match
   01B7 CDr00r00      [17]  377 	call	_calque4000
                            378 ;src/main.c:300: screen_location=0x1000;
   01BA 21 00 10      [10]  379 	ld	hl, #0x1000
   01BD 22r00r00      [16]  380 	ld	(_screen_location), hl
                            381 ;src/main.c:301: screen_plot_address=0x4000+80-2;
   01C0 21 4E 40      [10]  382 	ld	hl, #0x404e
   01C3 22r02r00      [16]  383 	ld	(_screen_plot_address), hl
                            384 ;src/main.c:303: while (1) {
   01C6                     385 00102$:
                            386 ;src/main.c:306: wait_frame_flyback();
   01C6 CDr00r00      [17]  387 	call	_wait_frame_flyback
                            388 ;src/main.c:311: s=(s+1)%8;
   01C9 DD 4E FE      [19]  389 	ld	c,-2 (ix)
   01CC DD 46 FF      [19]  390 	ld	b,-1 (ix)
   01CF 03            [ 6]  391 	inc	bc
   01D0 21 08 00      [10]  392 	ld	hl, #0x0008
   01D3 E5            [11]  393 	push	hl
   01D4 C5            [11]  394 	push	bc
   01D5 CDr00r00      [17]  395 	call	__modsint
   01D8 F1            [10]  396 	pop	af
   01D9 F1            [10]  397 	pop	af
   01DA DD 75 FE      [19]  398 	ld	-2 (ix), l
   01DD DD 74 FF      [19]  399 	ld	-1 (ix), h
                            400 ;src/main.c:312: cpct_drawSprite(g_tile_schtroumpf4x32_tileset[s], screen_plot_address, G_TILE_SCHTROUMPF4X32_0_W, G_TILE_SCHTROUMPF4X32_0_H);
   01E0 ED 5Br02r00   [20]  401 	ld	de, (_screen_plot_address)
   01E4 01r00r00      [10]  402 	ld	bc, #_g_tile_schtroumpf4x32_tileset+0
   01E7 DD 6E FE      [19]  403 	ld	l,-2 (ix)
   01EA DD 66 FF      [19]  404 	ld	h,-1 (ix)
   01ED 29            [11]  405 	add	hl, hl
   01EE 09            [11]  406 	add	hl, bc
   01EF 4E            [ 7]  407 	ld	c, (hl)
   01F0 23            [ 6]  408 	inc	hl
   01F1 46            [ 7]  409 	ld	b, (hl)
   01F2 21 02 20      [10]  410 	ld	hl, #0x2002
   01F5 E5            [11]  411 	push	hl
   01F6 D5            [11]  412 	push	de
   01F7 C5            [11]  413 	push	bc
   01F8 CDr00r00      [17]  414 	call	_cpct_drawSprite
   01FB 18 C9         [12]  415 	jr	00102$
                            416 	.area _CODE
                            417 	.area _INITIALIZER
   0000                     418 __xinit__intCounter:
   0000 00                  419 	.db #0x00	; 0
   0001                     420 __xinit__hOffset:
   0001 00 00               421 	.dw #0x0000
   0003                     422 __xinit__slow:
   0003 00                  423 	.db #0x00	; 0
                            424 	.area _CABS (ABS)
